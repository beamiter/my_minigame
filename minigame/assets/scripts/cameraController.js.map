{"version":3,"sources":["__temp/buildProcess/inlineFunctionProcess/scripts/cameraController.ts"],"names":[],"mappings":";;;AAAA,iCAAuC;AAGvC;IAA8C,4CAAa;IAA3D;QAAA,qEA6DC;QAzDQ,UAAI,GAAW,QAAQ,CAAA;QAEtB,mBAAa,GAAY,gBAAO,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAC3D,eAAS,GAAY,gBAAO,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACvD,gBAAU,GAAY,gBAAO,CAAC,gBAAgB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QACxD,gBAAU,GAAW,GAAG,CAAC;QACzB,cAAQ,GAAY,KAAK,CAAC;QAC1B,cAAQ,GAAW,CAAC,CAAC;;IAkD/B,CAAC;IAhDQ,yCAAc,GAArB,UAAsB,GAAY;QAChC,IAAI,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;QACzC,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC;QACzB,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC;QAEpD,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC;QAGpD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;QACpE,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;IACvB,CAAC;IAED,sBAAI,0CAAY;aAKhB;YACE,OAAO,IAAI,CAAC,aAAa,CAAC;QAC5B,CAAC;aAPD,UAAiB,GAAY;YAC3B,IAAI,CAAC,aAAa,GAAG,GAAG,CAAC,KAAK,EAAE,CAAC;QACnC,CAAC;;;OAAA;IAOM,kCAAO,GAAd;IACA,CAAC;IAEM,mCAAQ,GAAf,UAAgB,EAAU;QACxB,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YAClB,OAAO;SACR;QAGD,IAAI,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU,EAAE;YACnC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU,CAAC;YACjD,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;YAClB,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;YACtB,gBAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;SACpD;aAAM;YACL,IAAI,CAAC,QAAQ,IAAI,EAAE,CAAC;YACpB,IAAI,KAAK,GAAG,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;YACjC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,GAAG,CAChC,gBAAO,CAAC,gBAAgB,CACtB,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,KAAK,EAAE,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,KAAK,CAAC,EACxD,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;SACnC;IACH,CAAC;IAEM,oCAAS,GAAhB;IAEA,CAAC;IAxDD;QAHC,gBAAM,CAAC,UAAU,CAAC,QAAQ,CAAC;YAC1B,IAAI,EAAE,gBAAM,CAAC,SAAS,CAAC,MAAM;SAC9B,CAAC;kDAC4B;IAJX,gBAAgB;QADpC,gBAAM,CAAC,UAAU,CAAC,SAAS,CAAC,kBAAkB,CAAC;OAC3B,gBAAgB,CA6DpC;IAAD,uBAAC;CA7DD,AA6DC,CA7D6C,gBAAM,CAAC,MAAM,GA6D1D;kBA7DoB,gBAAgB","file":"cameraController.js","sourcesContent":["import engine, {Vector3} from \"engine\";\r\n\r\n@engine.decorators.serialize(\"cameraController\")\r\nexport default class CameraController extends engine.Script {\r\n  @engine.decorators.property({\r\n    type: engine.TypeNames.String\r\n  })\r\n  public name: string = \"myname\"\r\n\r\n  private _targetAnchor: Vector3 = Vector3.createFromNumber(0, 0, 0);\r\n  private _deltaPos: Vector3 = Vector3.createFromNumber(0, 0, 0);\r\n  private _targetPos: Vector3 = Vector3.createFromNumber(0, 0, 0);\r\n  private _epochTime: number = 0.5;\r\n  private _canMove: boolean = false;\r\n  private _curTime: number = 0;\r\n\r\n  public shiftCameraPos(pos: Vector3) {\r\n    let prevPos = this._targetAnchor.clone();\r\n    this._targetAnchor = pos;\r\n    this._deltaPos.x = this._targetAnchor.x - prevPos.x;\r\n    // y is not necessary.\r\n    this._deltaPos.z = this._targetAnchor.z - prevPos.z;\r\n    // console.log(pos, shiftPos);\r\n    // Update target pos.\r\n    this.entity.transform.position.add(this._deltaPos, this._targetPos);\r\n    this._canMove = true;\r\n  }\r\n  // @ts-ignore\r\n  set targetAnchor(pos: Vector3) {\r\n    this._targetAnchor = pos.clone();\r\n  }\r\n\r\n  // @ts-ignore\r\n  get targetAnchor(): Vector3 {\r\n    return this._targetAnchor;\r\n  }\r\n\r\n  public onAwake() {\r\n  }\r\n\r\n  public onUpdate(dt: number) {\r\n    if (!this._canMove) {\r\n      return;\r\n    }\r\n\r\n    // This is for moving logic.\r\n    if (this._curTime > this._epochTime) {\r\n      this.entity.transform.position = this._targetPos;\r\n      this._curTime = 0;\r\n      this._canMove = false;\r\n      engine.game.customEventEmitter.emit('CAMERA_MOVE');\r\n    } else {\r\n      this._curTime += dt;\r\n      let ratio = dt / this._epochTime;\r\n      this.entity.transform.position.add(\r\n        Vector3.createFromNumber(\r\n          this._deltaPos.x * ratio, 0, this._deltaPos.z * ratio),\r\n        this.entity.transform.position);\r\n    }\r\n  }\r\n\r\n  public onDestroy() {\r\n\r\n  }\r\n}\r\n"]}